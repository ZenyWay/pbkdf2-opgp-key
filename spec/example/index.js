(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var src_1=require("../../src"),opgp_service_1=require("opgp-service"),debug=require("debug");debug.enable("example:*");var opgp=opgp_service_1.default(),getPbkdf2OpgpKey=src_1.default(opgp,{pbkdf2:{salt:32,iterations:8192,length:64}});debug("example:")("generate key...");var key=getPbkdf2OpgpKey("j.doe@example.com","secret passphrase");key.then(debug("example:key:"));var armor=key.then(function(e){return e.toArmor()});armor.then(debug("example:armor:")),armor.then(function(e){return getPbkdf2OpgpKey(e,"secret passphrase")}).then(debug("example:from-armor:"));
},{"../../src":2,"debug":undefined,"opgp-service":undefined}],2:[function(require,module,exports){
"use strict";function getPbkdf2OpgpKey(e,r,t,n){return utils_1.isString(t)?getPbkdf2OpgpKey(e,r,{user:t,passphrase:n}):isValidCredentials(t)?Pbkdf2OpgpKeyClass.newInstance(e,r,t.user,t.passphrase):isValidKeyArmor(t)&&utils_1.isString(n)?Pbkdf2OpgpKeyClass.fromPbkdf2KeyArmor(e,r,t,n):Promise.reject(new TypeError("invalid arguments"))}function wrapInstance(e){return e.then(function(e){return{key:e.key,pbkdf2:e.pbkdf2,unlock:function(r){return wrapInstance(e.unlock(r))},toArmor:function(){return e.toArmor()},clone:function(){return wrapInstance(e.clone())}}})}function isValidOpgpService(e){return!!e&&OPGP_SERVICE_METHODS.every(function(r){return utils_1.isFunction(e[r])})}function isValidCredentials(e){return!!e&&utils_1.isString(e.user)&&utils_1.isString(e.passphrase)}function isValidKeyArmor(e){return!!e&&utils_1.isString(e.armor)&&!!e.pbkdf2&&utils_1.isString(e.pbkdf2.salt)}Object.defineProperty(exports,"__esModule",{value:!0});var utils_1=require("./utils"),tslib_1=require("tslib"),KEY_SIZE_DEFAULT=2048,getPbkdf2OpgpKeyFactory=function(e,r){function t(r,t){var i=Promise.all([r,t]).then(function(r){var t=r[0],i=r[1];return getPbkdf2OpgpKey(e,n,t,i)});return wrapInstance(i)}if(!isValidOpgpService(e))throw new TypeError("invalid argument");var n=tslib_1.__assign({},{size:KEY_SIZE_DEFAULT},r);return n.pbkdf2=tslib_1.__assign({},n.pbkdf2),n.getkdf=utils_1.isFunction(n.getkdf)?n.getkdf:require("pbkdf2sha512").default,t},Pbkdf2OpgpKeyClass=function(){function e(e,r,t,n){this.getPbkdf2=e,this.opgp=r,this.key=t,this.pbkdf2=n}return e.newInstance=function(r,t,n,i){var s=t.getkdf(t.pbkdf2);return s(i).then(function(i){return Promise.resolve(r.generateKey(n,{passphrase:i.value,size:t.size,unlocked:!t.locked})).then(function(n){return new e(t.getkdf,r,n,i.spec)})})},e.fromPbkdf2KeyArmor=function(r,t,n,i){var s=t.getkdf(tslib_1.__assign({},t.pbkdf2,n.pbkdf2)),o=r.getKeysFromArmor(n.armor).then(function(e){return Array.isArray(e)?Promise.reject(new Error("unsupported multiple key armor")):e});return Promise.all([o,s(i)]).then(function(n){var i=n[0],s=n[1];return r.unlock(i,s.value).then(function(n){return new e(t.getkdf,r,n,s.spec)})})},e.prototype.unlock=function(r){var t=this;if(!utils_1.isString(r))return Promise.reject(new TypeError("invalid argument"));var n=this.getPbkdf2(this.pbkdf2);return n(r).then(function(e){return Promise.resolve(t.opgp.unlock(t.key,e.value))}).then(function(r){return new e(t.getPbkdf2,t.opgp,r,t.pbkdf2)})},e.prototype.toArmor=function(){var e=this;return Promise.resolve(this.opgp.getArmorFromKey(this.key)).then(function(r){return{armor:r,pbkdf2:tslib_1.__assign({},e.pbkdf2)}})},e.prototype.clone=function(){var r=this;return Promise.resolve(this.opgp.getArmorFromKey(this.key)).then(function(e){return r.opgp.getKeysFromArmor(e)}).then(function(t){return new e(r.getPbkdf2,r.opgp,t,r.pbkdf2)})},e}(),OPGP_SERVICE_METHODS=["generateKey","getKeysFromArmor","getArmorFromKey","unlock"];exports.default=getPbkdf2OpgpKeyFactory;
},{"./utils":3,"pbkdf2sha512":undefined,"tslib":undefined}],3:[function(require,module,exports){
"use strict";function isString(t){return"string"==typeof(t&&t.valueOf())}function isNumber(t){return"number"==typeof(t&&t.valueOf())}function isFunction(t){return"function"==typeof t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isString=isString,exports.isNumber=isNumber,exports.isFunction=isFunction;
},{}]},{},[1]);
