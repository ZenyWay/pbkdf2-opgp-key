!function(){return function e(n,t,r){function o(a,u){if(!t[a]){if(!n[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var p=t[a]={exports:{}};n[a][0].call(p.exports,function(e){return o(n[a][1][e]||e)},p,p.exports,e,n,t,r)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,n,t){"use strict";var r,o,i,a,u,c=e(2).default;beforeEach(function(){i={handle:(o={handle:"key-handle"}).handle,isLocked:!0},a={value:"digest",spec:{}};var e=jasmine.createSpy("pbkdf2").and.returnValue(Promise.resolve(a)),n=jasmine.createSpy("getkdf").and.returnValue(e),t=jasmine.createSpy("generateKey").and.returnValue(Promise.resolve(i)),c=jasmine.createSpy("getKeysFromArmor"),s=jasmine.createSpy("getArmorFromKey"),p=jasmine.createSpy("unlock"),f=jasmine.createSpy("lock");r={getkdf:n,pbkdf2:e,opgp:{generateKey:t,getKeysFromArmor:c,getArmorFromKey:s,unlock:p,lock:f}},u={user:"j.doe@test.org",passphrase:"secret passphrase"}}),describe("getPbkdf2OpgpKeyFactory (opgp: OpgpService, config?: Partial<Pbdkf2OpgpKeyConfig>): Pbdkf2OpgpKeyFactory",function(){it("returns a function",function(){expect(c(r.opgp)).toEqual(jasmine.any(Function))}),describe("when called with an OpgpService instance",function(){beforeEach(function(e){c(r.opgp,{getkdf:r.getkdf})(u).then(function(e){return e.unlock(u.passphrase)}).then(function(){return setTimeout(e)}).catch(function(n){return setTimeout(function(){return e.fail(n)})})}),it("configures the returned function with that instance and default settings",function(){expect(r.opgp.generateKey).toHaveBeenCalled(),expect(r.opgp.unlock).toHaveBeenCalled(),expect(r.getkdf).toHaveBeenCalledWith({}),expect(r.opgp.generateKey).toHaveBeenCalledWith(u.user,jasmine.objectContaining({passphrase:a.value,size:2048,unlocked:!0}))})}),describe("when called with an OpgpService instance and a Pbdkf2OpgpKeyConfig instance { size?: number, locked?: boolean, pbkdf2?: Partial<Pbkdf2Sha512Config> }",function(){var e;beforeEach(function(n){e={size:4096,locked:!0,pbkdf2:{},getkdf:r.getkdf},c(r.opgp,e)(u).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),it("configures the returned function accordingly",function(){expect(r.getkdf).toHaveBeenCalledWith(e.pbkdf2),expect(r.opgp.generateKey).toHaveBeenCalledWith(u.user,jasmine.objectContaining({passphrase:a.value,size:e.size,unlocked:!e.locked}))})}),describe("when called with anything else than a valid OpgpService instance",function(){var e,n;beforeEach(function(){e=[null,void 0,!0,42,"foo",function(){return"foo"},["foo"],{foo:"bar"}],n=function(e){return function(){return c(e,{getkdf:r.getkdf})}}}),it('throws an "invalid argument" TypeError',function(){e.every(function(e){return expect(n(e)).toThrowError(TypeError,"invalid argument")}),expect(r.opgp.generateKey).not.toHaveBeenCalled(),expect(r.opgp.unlock).not.toHaveBeenCalled(),expect(r.getkdf).not.toHaveBeenCalled(),expect(r.opgp.generateKey).not.toHaveBeenCalled()})})}),describe("getPbkdf2OpgpKey (creds: Credentials): Promise<Pbkdf2OpgpKey>",function(){var e,n;beforeEach(function(){n={iterations:1,relaxed:!0},e=c(r.opgp,{getkdf:r.getkdf,pbkdf2:n})}),describe("when called with a Credentials object: { user: string, passphrase: string }",function(){var t;beforeEach(function(n){e(u).then(function(e){return t=e}).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),it("returns a Pbkdf2OpgpKey object:  { key: OpgpProxyKey, pbkdf2: Pbkdf2Sha512Config, unlock: (passphrase: string) => Promise<Pbkdf2OpgpKey>",function(){expect(r.opgp.getArmorFromKey).toHaveBeenCalledWith(i),expect(r.getkdf).toHaveBeenCalledWith(n),expect(t).toEqual({key:i,pbkdf2:a.spec,unlock:jasmine.any(Function),toArmor:jasmine.any(Function),clone:jasmine.any(Function)})})}),describe("when called with anything else",function(){var n,t;beforeEach(function(r){n=[null,void 0,!0,42,"foo",function(){return"foo"},["foo"],{user:42,passphrase:"passphrase"},{user:"j.doe@test.org",passphrase:42}],Promise.all(n.map(function(n){return e(n).catch(function(e){return e})})).then(function(e){return t=e}).then(function(){return setTimeout(r)}).catch(function(e){return setTimeout(function(){return r.fail(e)})})}),it('rejects with an "invalid credentials" TypeError',function(){expect(r.opgp.getArmorFromKey).not.toHaveBeenCalled(),expect(t.length).toBe(n.length),t.every(function(e){return expect(e).toEqual(jasmine.any(TypeError))&&expect(e.message).toBe("invalid credentials")})})})}),describe("getPbkdf2OpgpKey (armor: { armor: string, pbkdf2: Pbkdf2sha512DigestSpec }, passphrase: string): Promise<Pbkdf2OpgpKey>",function(){var e;beforeEach(function(){e=c(r.opgp,{getkdf:r.getkdf})}),describe("when called with an armor of a locked key and a passphrase",function(){var n,t;beforeEach(function(a){r.opgp.getKeysFromArmor.and.returnValue(Promise.resolve(i)),r.opgp.unlock.and.returnValue(Promise.resolve(o)),e(t={armor:"armor",pbkdf2:{salt:"salt",iterations:1,relaxed:!0}},u.passphrase).then(function(e){return n=e}).then(function(){return setTimeout(a)}).catch(function(e){return setTimeout(function(){return a.fail(e)})})}),it("returns a Pbkdf2OpgpKey object encapsulating the extracted key: { key: OpgpProxyKey, pbkdf2: Pbkdf2Sha512Config, unlock: (passphrase: string) => Promise<Pbkdf2OpgpKey>",function(){expect(n).toEqual({key:o,pbkdf2:a.spec,unlock:jasmine.any(Function),toArmor:jasmine.any(Function),clone:jasmine.any(Function)}),expect(r.getkdf).toHaveBeenCalledWith(jasmine.objectContaining(t.pbkdf2)),expect(r.opgp.getKeysFromArmor).toHaveBeenCalledWith("armor"),expect(r.pbkdf2).toHaveBeenCalledWith(u.passphrase),expect(r.opgp.unlock).toHaveBeenCalledWith(i,a.value),expect(r.opgp.lock).not.toHaveBeenCalled()})}),describe("when called with an armor of an unlocked key and a passphrase",function(){var n,t;beforeEach(function(a){r.opgp.getKeysFromArmor.and.returnValues(Promise.resolve(o),Promise.resolve(i)),r.opgp.getArmorFromKey.and.returnValue(Promise.resolve("locked-armor")),r.opgp.unlock.and.returnValue(Promise.resolve(o)),r.opgp.lock.and.returnValue(Promise.resolve(i)),e(t={armor:"armor",pbkdf2:{salt:"salt",iterations:1,relaxed:!0}},u.passphrase).then(function(e){return n=e}).then(function(){return setTimeout(a)}).catch(function(e){return setTimeout(function(){return a.fail(e)})})}),it("returns a Pbkdf2OpgpKey object encapsulating the extracted key: { key: OpgpProxyKey, pbkdf2: Pbkdf2Sha512Config, unlock: (passphrase: string) => Promise<Pbkdf2OpgpKey>",function(){expect(n).toEqual({key:o,pbkdf2:a.spec,unlock:jasmine.any(Function),toArmor:jasmine.any(Function),clone:jasmine.any(Function)}),expect(r.getkdf).toHaveBeenCalledWith(jasmine.objectContaining(t.pbkdf2)),expect(r.opgp.getKeysFromArmor).toHaveBeenCalledWith("armor"),expect(r.pbkdf2).toHaveBeenCalledWith(u.passphrase),expect(r.opgp.lock).toHaveBeenCalledWith(o,a.value),expect(r.opgp.getArmorFromKey).toHaveBeenCalledWith(i),expect(r.opgp.getKeysFromArmor).toHaveBeenCalledWith("locked-armor"),expect(r.opgp.unlock).toHaveBeenCalledWith(i,a.value)})}),describe("when called with an armored string representation of multiple private keys",function(){var n;beforeEach(function(t){r.opgp.getKeysFromArmor.and.returnValue(Promise.resolve([i,i])),e({armor:"armor",pbkdf2:{salt:"salt"}},u.passphrase).then(function(e){return setTimeout(function(){return t.fail(new Error(e))})}).catch(function(e){return n=e}).then(function(){return setTimeout(t)})}),it('rejects with an "unsupported multiple key armor" Error',function(){expect(n).toEqual(jasmine.any(Error)),expect(n.message).toBe("unsupported multiple key armor"),expect(r.opgp.getKeysFromArmor).toHaveBeenCalledWith("armor"),expect(r.opgp.lock).not.toHaveBeenCalled()})}),describe("when called with an incorrect passphrase string",function(){var n;beforeEach(function(t){r.opgp.getKeysFromArmor.and.returnValue(Promise.resolve(i)),r.opgp.unlock.and.returnValue(Promise.reject(new TypeError("boom"))),e({armor:"armor",pbkdf2:{salt:"salt"}},u.passphrase).then(function(e){return setTimeout(function(){return t.fail(new Error(e))})}).catch(function(e){return n=e}).then(function(){return setTimeout(t)})}),it("rejects with the error thrown by the underlying OpgpService#unlock method",function(){expect(n).toEqual(jasmine.any(Error)),expect(n.message).toBe("boom"),expect(r.opgp.getKeysFromArmor).toHaveBeenCalledWith("armor"),expect(r.pbkdf2).toHaveBeenCalledWith(u.passphrase),expect(r.opgp.unlock).toHaveBeenCalledWith(i,a.value),expect(r.opgp.lock).not.toHaveBeenCalled()})}),describe("when called with anything else",function(){var n,t;beforeEach(function(r){var o=(n=[null,void 0,!0,42,function(){return"foo"},["foo"],{foo:"bar"}]).map(function(n){return e(n,"armor")}).concat(n.map(function(n){return e("passphrase",n)}));Promise.all(o.map(function(e){return e.catch(function(e){return e})})).then(function(e){return t=e}).then(function(){return setTimeout(r)}).catch(function(e){return setTimeout(function(){return r.fail(e)})})}),it('rejects with an "invalid argument" TypeError',function(){expect(t.length).toBe(2*n.length),t.every(function(e){return expect(e).toEqual(jasmine.any(TypeError))&&expect(e.message).toBe("invalid argument")})})})}),describe("Pbkdf2OpgpKey",function(){var e;beforeEach(function(n){r.opgp.getArmorFromKey.and.returnValue(Promise.resolve("armor")),c(r.opgp,{getkdf:r.getkdf})(u).then(function(n){return e=n}).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),describe("unlock (passphrase: string): Promise<Pbkdf2OpgpKey>",function(){describe("when called with the correct passphrase string",function(){var n;beforeEach(function(t){r.opgp.unlock.and.returnValue(Promise.resolve(i)),e.unlock(u.passphrase).then(function(e){return n=e}).then(function(){return setTimeout(t)}).catch(function(e){return setTimeout(function(){return t.fail(e)})})}),it("returns an unlocked instance of the key",function(){expect(r.opgp.unlock).toHaveBeenCalledWith(i,a.value),expect(n).toEqual({key:i,pbkdf2:a.spec,unlock:jasmine.any(Function),toArmor:jasmine.any(Function),clone:jasmine.any(Function)})})}),describe("when called with any other string than the correct passphrase",function(){var n;beforeEach(function(t){r.opgp.unlock.and.returnValue(Promise.reject(new TypeError("boom"))),e.unlock(u.passphrase).catch(function(e){return n=e}).then(function(){return setTimeout(t)}).catch(function(e){return setTimeout(function(){return t.fail(e)})})}),it("rejects with the error thrown by the underlying OpgpService#unlock method",function(){expect(n).toEqual(jasmine.any(TypeError)),expect(n.message).toBe("boom")})}),describe("when called with anything else than a string",function(){var n,t;beforeEach(function(r){n=[null,void 0,!0,42,function(){return"foo"},["foo"],{foo:"bar"}],Promise.all(n.map(function(n){return e.unlock(n).catch(function(e){return e})})).then(function(e){return t=e}).then(function(){return setTimeout(r)}).catch(function(e){return setTimeout(function(){return r.fail(e)})})}),it('rejects with an "invalid argument" TypeError',function(){expect(t.length).toBe(n.length),expect(r.opgp.unlock).not.toHaveBeenCalled(),t.every(function(e){return expect(e).toEqual(jasmine.any(TypeError))&&expect(e.message).toBe("invalid argument")})})})}),describe("toArmor (): Promise<string>",function(){var n;beforeEach(function(t){r.opgp.getArmorFromKey.calls.reset(),e.toArmor().then(function(e){return n=e}).then(function(){return setTimeout(t)}).catch(function(e){return setTimeout(function(){return t.fail(e)})})}),it("returns the armored string representation of the key",function(){expect(r.opgp.getArmorFromKey).not.toHaveBeenCalled(),expect(n).toEqual({armor:"armor",pbkdf2:a.spec})})}),describe("clone (): Promise<string>",function(){var n;beforeEach(function(t){r.opgp.getArmorFromKey.calls.reset(),r.opgp.getKeysFromArmor.and.returnValue(Promise.resolve(i)),e.clone().then(function(e){return n=e}).then(function(){return setTimeout(t)}).catch(function(e){return setTimeout(function(){return t.fail(e)})})}),it("returns a locked clone of the key",function(){expect(r.opgp.getArmorFromKey).not.toHaveBeenCalled(),expect(r.opgp.getKeysFromArmor).toHaveBeenCalledWith("armor"),expect(r.opgp.unlock).not.toHaveBeenCalled(),expect(n).toEqual({key:i,pbkdf2:a.spec,unlock:jasmine.any(Function),toArmor:jasmine.any(Function),clone:jasmine.any(Function)})})})})},{2:2}],2:[function(e,n,t){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=e(3);var i=function(){function e(e,n,t,r,o){this.getPbkdf2=e,this.opgp=n,this.armor=t,this.key=r,this.pbkdf2=o}return e.newInstance=function(n,t,r,o){return t.getkdf(a(t.pbkdf2))(o).then(function(o){return n.generateKey(r,{passphrase:o.value,size:t.size,unlocked:!t.locked}).then(function(r){return e.fromOpgpProxyKey(t.getkdf,n,r,o.spec)})})},e.fromPbkdf2KeyArmor=function(n,t,o,i){var u=t.getkdf(a(r({},t.pbkdf2,o.pbkdf2)))(i),c=function(e){return n.getKeysFromArmor(e).then(function(e){return Array.isArray(e)?Promise.reject(new Error("unsupported multiple key armor")):e})}(o.armor);return Promise.all([c,u]).then(function(r){return function(r,i){var a=i.value;return r.isLocked?n.unlock(r,a).then(function(r){return new e(t.getkdf,n,o.armor,r,i.spec)}):n.lock(r,a).then(s)}(r[0],r[1])});function s(a){return n.getArmorFromKey(a).then(function(a){return e.fromPbkdf2KeyArmor(n,t,{armor:a,pbkdf2:r({},o.pbkdf2)},i)})}},e.prototype.unlock=function(e){var n=this;if(!o.isString(e))return Promise.reject(new TypeError("invalid argument"));var t=r({},this.pbkdf2,{relaxed:this.pbkdf2.iterations<8192});return this.getPbkdf2(t)(e).then(function(e){return Promise.resolve(n.opgp.unlock(n.key,e.value))}).then(function(e){return n._getInstance(e)})},e.prototype.toArmor=function(){return Promise.resolve({armor:this.armor,pbkdf2:r({},this.pbkdf2)})},e.prototype.clone=function(){var e=this;return Promise.resolve(this.opgp.getKeysFromArmor(this.armor)).then(function(n){return e._getInstance(n)})},e.fromOpgpProxyKey=function(n,t,r,o){return Promise.resolve(t.getArmorFromKey(r)).then(function(i){return new e(n,t,i,r,o)})},e.prototype._getInstance=function(n){return new e(this.getPbkdf2,this.opgp,this.armor,n,this.pbkdf2)},e}();function a(e){var n=r({},e);return"none"===n.encoding&&delete n.encoding,n}var u=["generateKey","getKeysFromArmor","getArmorFromKey","unlock"];t.default=function(n,t){if(!function(e){return!!e&&u.every(function(n){return o.isFunction(e[n])})}(n))throw new TypeError("invalid argument");var a=r({size:2048},t);return a.pbkdf2=r({},a.pbkdf2),a.getkdf=o.isFunction(a.getkdf)?a.getkdf:e("pbkdf2sha512").default,function(e,t){return function e(n){return n.then(function(n){return{key:n.key,pbkdf2:n.pbkdf2,unlock:function(t){return e(n.unlock(t))},toArmor:function(){return n.toArmor()},clone:function(){return e(n.clone())}}})}(Promise.all([e,t]).then(function(e){var t=e[0],r=e[1];return function e(n,t,r,a){return o.isString(r)?e(n,t,{user:r,passphrase:a}):function(e){return!!e&&o.isString(e.user)&&o.isString(e.passphrase)}(r)?i.newInstance(n,t,r.user,r.passphrase):function(e){return!!e&&o.isString(e.armor)&&function(e){return!!e&&o.isString(e.salt)}(e.pbkdf2)}(r)&&o.isString(a)?i.fromPbkdf2KeyArmor(n,t,r,a):Promise.reject(new TypeError("invalid arguments"))}(n,a,t,r)}))}}},{3:3,undefined:void 0}],3:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isString=function(e){return"string"==typeof(e&&e.valueOf())},t.isFunction=function(e){return"function"==typeof e}},{}]},{},[1]);